# 好慷智能体API和知识库集成配置
version: "1.0"

# 业务API配置
business_apis:
  # 查询订单API
  - name: get_orders
    description: 获取用户订单列表
    method: GET
    url: "{{base_url}}/api/orders"
    headers:
      - name: "Authorization"
        value: "Bearer {{api_key}}"
    params:
      - name: "user_id"
        in: "query"
        required: true
        description: "用户ID"
    response_schema:
      type: "array"
      items:
        type: "object"
        properties:
          order_id:
            type: "string"
          service_time:
            type: "string"
          service_type:
            type: "string"
          service_person:
            type: "string"
          status:
            type: "string"

  # 检查订单可修改性API
  - name: check_order_modify
    description: 检查订单是否可以修改
    method: POST
    url: "{{base_url}}/api/orders/check-modify"
    headers:
      - name: "Authorization"
        value: "Bearer {{api_key}}"
    body:
      type: "object"
      required:
        - order_id
        - new_time
      properties:
        order_id:
          type: "string"
        new_time:
          type: "string"
    response_schema:
      type: "object"
      properties:
        can_modify:
          type: "boolean"
        message:
          type: "string"
        available_slots:
          type: "array"
          items:
            type: "string"

  # 修改订单API
  - name: update_order
    description: 修改订单信息
    method: PUT
    url: "{{base_url}}/api/orders/{order_id}"
    headers:
      - name: "Authorization"
        value: "Bearer {{api_key}}"
    path_params:
      - name: "order_id"
        required: true
        description: "订单ID"
    body:
      type: "object"
      properties:
        service_time:
          type: "string"
        service_person:
          type: "string"
    response_schema:
      type: "object"
      properties:
        success:
          type: "boolean"
        message:
          type: "string"
        order:
          type: "object"
          properties:
            order_id:
              type: "string"
            service_time:
              type: "string"

  # 取消订单API
  - name: cancel_order
    description: 取消订单
    method: POST
    url: "{{base_url}}/api/orders/{order_id}/cancel"
    headers:
      - name: "Authorization"
        value: "Bearer {{api_key}}"
    path_params:
      - name: "order_id"
        required: true
        description: "订单ID"
    response_schema:
      type: "object"
      properties:
        success:
          type: "boolean"
        message:
          type: "string"

# 知识库配置
knowledge_base:
  - name: service_notes
    description: 服务笔记知识库
    type: "vector_db"
    embedding_model: "text-embedding-ada-002"
    similarity_threshold: 0.8
    max_results: 5
    fields:
      - name: "note_id"
        type: "string"
      - name: "content"
        type: "string"
      - name: "service_date"
        type: "string"
      - name: "service_person"
        type: "string"
      - name: "user_id"
        type: "string"
    query_template: |
      你是好慷智能体，根据用户问题从知识库中查找相关服务笔记。
      用户问题: {{user_query}}
      用户ID: {{user_id}}
    response_template: |
      找到以下相关服务笔记：
      {% for result in results %}
      - 服务日期: {{result.service_date}}
        服务人员: {{result.service_person}}
        笔记内容: {{result.content[:100]}}...
        详情: [查看详情]({{result.note_id}})
      {% endfor %}
      {% if not results %}
      没有找到相关的服务笔记。
      {% endif %}